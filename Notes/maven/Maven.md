# JAR

**JAR-файл** — это Java-архив (Java ARchive). Это простой архивный файл, сжатый (иногда с нулевой компрессией) по алгоритму zip.

Он был создан для удобства распространения программ, написанных на Java. Так как обычная программа содержит сотни, тысячи, а иногда и миллионы файлов. Файл может содержать:
- файл манифеста `META-INF/MANIFEST.MF`
- java-файлы (исходный код)
- class-файлы
- файлы, необходимые для работы программы: картинки, файлы с настройками и прочее (ресурсы)
- электронные подписи, которые позволяют защитить программу от модификации

**Манифест** - это текстовый файл формата ключ: значение; он содержит описание jar-файла. В нем могут быть следующие ключи:
- **Manifest-Version** - версия манифеста
- **Main-Class** - имя главного класса (должен содержать метод main), такой jar-файл можно запустить как обычный исполняемый файл
- **Class-Path** - позволяет указать CLASSPATH, который необходим для полноценной работы программы
- **SHA-Digest** - контрольная сумма определенного файла внутри архива

# Maven

## Основные фазы сборки

1. _compile_ - компилирование проекта;
2. _test_ - тестирование с помощью JUnit тестов;
3. _package_ - создание jar файла или war, ear в зависимости от типа проекта;
4. _integration-test_ - запуск интеграционных тестов;
5. _install_ - копирование jar (war, ear) в локальный репозиторий;
6. _deploy_ - публикация файла в удалённый репозиторий.

При выполнении команды `mvn команда` выполняется текущая команда и все предыдущие.

## Фазы clean и site

Фазы clean и site **выполняются только если специально указаны в строке запуска**.

**clean** - удаление всех созданных в процессе сборки артефактов: _.class_, _.jar_ и др. файлов.
В простейшем случае результат — просто удаление каталога _target_.

**site** - предназначена для создания документации.

Т.к. команда _mvn_ понимает когда ему передают несколько фаз, то **для создания документации "с нуля" выполняют**:
`mvn clean package site`

# Pom.xml

## Корневой элемент

Корневой элемент <project>, в котором прописана схема облегчающая редактирование и проверку, и версия POM.
```maven
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    ...
</project>
```

## Заголовок

```maven
<groupId>com.examclouds</groupId>
<artifactId>courses</artifactId>
<version>1.0-SNAPSHOT</version>
```

Тройкой groupId, artifactId, version (далее - GAV) можно однозначно идентифицировать jar файл приложения или библиотеки.

## Тег packaging

Тег _<packaging>_ определяет какого типа файл будет создаваться как результат сборки. Возможные варианты pom, jar, war, ear.

Тег является необязательным. Если его нет, используется значение по умолчанию - jar.

## Зависимости | Dependencies

Зависимости - следующая очень важная часть pom.xml - тут хранится список всех библиотек (зависимостей) которые
используются в проекте. Каждая библиотека идентифицируется так же как и сам проект - тройкой groupId, artifactId,
version (GAV). Объявление зависимостей заключено в теге `<dependencies>`.

### Установка зависимостей

**Когда вы добавляете зависимость в файл pom.xml** вашего проекта (pom.xml - это файл проекта Maven),
Maven будет автоматически скачивать и устанавливать эту зависимость из репозитория в локальный репозиторий на вашем
компьютере. **Локальный репозиторий** - это каталог, в котором хранятся зависимости, скачанные с **удаленного**
**репозитория** (обычно из репозитория Maven Central).

Далее, **при сборке вашего проекта или выполнении команды `mvn install`**, Maven будет использовать зависимости из
локального репозитория и добавлять их в проект. Это позволяет использовать код из зависимостей в вашем Java-коде, так как **Maven автоматически включит нужные классы в итоговый JAR-файл или другой артефакт**.

### Тег scope

Кроме GAV при описании зависимости может присутствовать тег `<scope>`. Он **используется для указания области видимости**
зависимости в проекте. Это позволяет контролировать, как зависимость будет использоваться во время сборки проекта и на каких этапах она будет доступна. Зависимости с разными областями видимости имеют различное поведение в проекте.

- **compile** (по умолчанию): зависимость доступна на всех этапах сборки проекта;
- **provided**: зависимость будет доступна во время компилляции и тестирования, но не будет включена в итоговый артифакт;
- **test**: зависимость с областью видимости test используется только во время выполнения тестов,
она не включается в итоговый JAR-файл и не доступна приложению во время выполнения;
- **runtime**: зависимость с областью видимости runtime доступна только во время выполнения приложения, но не используется во время компиляции и тестирования.

## Тег build

Тег <build>  не обязательный, так как существуют значения по умолчанию. Этот раздел содержит информацию по самой сборке:

* где находятся исходные файлы,
* где ресурсы,
* какие плагины используются. 

# Репозитории

**Репозитории** - это место, где хранятся артефакты: jar файлы, pom файлы, javadoc, исходники.

Репозитории можно разделить на следующие:
* Локальный репозиторий
* Центральный репозиторий
* Внутренний "Корпоративный" репозиторий

## Локальный репозиторий

Персональный репозиторий для каждого пользователя. Здесь лежат артефакты, которые были скачаны из центрального
репозитория, либо добавлены другим способом.

## Центральный репозиторий

Репозиторий, откуда по умолчанию загружаются проекты. 

## Корпоративный репозиторий

Если вы хотите создать свой репозиторий, содержимое которого вы можете полностью контролировать (как локальный), и сделать так, чтобы он был доступен для нескольких человек, вам будет полезен корпоративный репозиторий. Доступ к артефактам можно ограничивать настройками безопасности сервера так, что код ваших проектов не будет доступен извне.

**Чтобы добавить репозиторий в список, откуда будут скачиваться зависимости**, нужно добавить секцию `repositories` в pom.xml.